extends layout.pug

block vars
  - var title='Compose'
  - var description='Compose a new post'

block content
  div(class="row-fluid")
    div(class="col-md-8 col-md-offset-2")
      form(method="post" enctype="multipart/form-data" id="post_data")
        div(class="form-group")
          label(for="title") Title
          input(type="text" class="form-control" name="title" placeholder="Title" required="true")
        div(class="form-group")
          label(for="date") Date
          input(type="date" class="form-control" name="date" id="date" required="true")
          input(type="datetime" name="date_time" id="date_time" hidden=true)
        div(class="form-group")
          label(for="header_image") Header Image
            input(type="file" name="header_image" id="header_image")
        div(class="panel panel-default")
          div(class="panel-heading") Body
          div(class="panel-body" style="min-height: 500px" id="body")
          textarea(name="body" required="true")
        script(src="/script/ace/ace.js") 
        script.
          var textarea = $('textarea[name="body"]').hide();
          var editor = ace.edit('body')
          editor.setOptions({fontFamily:"monospace", fontSize:"10pt"});
          editor.setTheme("ace/theme/monokai");
          editor.$blockScrolling = Infinity;
          editor.getSession().setMode("ace/mode/markdown");
          editor.getSession().setValue(textarea.val());
          editor.getSession().on("change", function() {
            textarea.val(editor.getSession().getValue());
          });
        div(class="form-group")
        div(class="checkbox")
          label
            <input type="checkbox" name="draft"> Draft
        button(type="submit" class="btn btn-default")
          <i class="fa fa-save"></i>&nbsp; Save
      script.
        document.getElementById('date').valueAsDate = new Date();
        $(function() {
          $(".target-active").find('[href="/dash/compose"]').parent().addClass("active");
        });
        $(document).ready(function() {
          let date = new Date($("#date").val());
          let time = new Date();
          date.setHours(time.getHours() + 24);
          date.setMinutes(time.getMinutes());
          date.setSeconds(time.getSeconds());
          $("#date_time").val(date.toISOString());
        });
        $(document).on("change", "#date", function() {
          let date = new Date($("#date").val());
          let time = new Date();
          date.setHours(time.getHours() + 24);
          date.setMinutes(time.getMinutes());
          date.setSeconds(time.getSeconds());
          $("#date_time").val(date.toISOString());
        });
